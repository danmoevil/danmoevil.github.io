[{"title":"Mac编译OpenJDK 7","date":"2017-01-12T02:57:45.000Z","path":"2017/01/12/Mac编译OpenJDK-7/","text":"转载自http://www.txazo.com/jvm/openjdk-compile.html，根据自己的经历稍加修改 系统环境 Mac OS X 10.12.2 JDK 1.6.0 Xcode 8.2.1 XQuartz 2.7.9 CUPS 2.2.1 GNU Make 3.81 Ant 1.9.8 下载OpenJDK源码 源码下载方式一: 使用Mercurial获取OpenJDK的源码，这种方式比较慢，很有可能中断，做好翻墙的准备 123hg clone http://hg.openjdk.java.net/jdk7u/jdk7ucd jdk7ubash ./get_source.sh 注：在用这个版本的源码编译时出现比较奇怪的问题，所以可以尝试采用方式二； 源码下载方式二: 官网下载: https://jdk7.java.net/source.html ，然后解压缩。 安装JDK1.6Mac版的jdk 1.6下载地址: https://support.apple.com/kb/DL1572 。 安装Xcode安装Xcode，直接通过App Store安装。 安装Command Line Tools: 1xcode-select --install 创建LLVM的软链接: 12sudo ln -s /usr/bin/llvm-gcc /Applications/Xcode.app/Contents/Developer/usr/bin/llvm-gccsudo ln -s /usr/bin/llvm-g++ /Applications/Xcode.app/Contents/Developer/usr/bin/llvm-g++ 安装XQuartz下载XQuartz并安装，安装完成后，执行下面的命令: 12cp -R /usr/X11/include/X11 /usr/local/include/X11sudo ln -s /usr/X11/include/freetype2/freetype/ /usr/X11/include/freetype 安装CUPS下载并安装CUPS: 123456wget https://github.com/apple/cups/releases/download/release-2.1.4/cups-2.1.4-source.tar.gztar -zxvf cups-2.1.4-source.tar.gzcd cups-2.1.4-source./configure --prefix=/usr/local/cupsmakesudo make install 注：在OS X 10.11 及之后版本 System Integrity Protection会阻止root权限修改系统文件,解决办法看这里 环境变量设置编译的环境变量: 12345678910export LANG=Cexport ALT_BOOTDIR=`/usr/libexec/java_home -v 1.6.0`export ALT_CUPS_HEADERS_PATH=&quot;/usr/local/cups/include&quot;export ALLOW_DOWNLOADS=trueexport USE_PRECOMPILED_HEADER=trueexport SKIP_DEBUG_BUILD=trueexport SKIP_FASTDEBUG_BUILD=falseexport DEBUG_NAME=debugunset CLASSPATHunset JAVA_HOME 编译检查运行下面的命令进行编译检查: 1sudo make sanity 若编译检查通过，输出如下: 1Sanity check passed. 开始编译运行下面的命令开始编译: 1sudo make CC=clang COMPILER_WARNINGS_FATAL=false LFLAGS=&apos;-Xlinker -lstdc++&apos; USE_CLANG=true LANG=C LP64=1 ARCH_DATA_MODEL=64 HOTSPOT_BUILD_JOBS=8 ALT_BOOTDIR=/Library/Java/Home _JAVA_OPTIONS=-Dfile.encoding=ASCII fastdebug_build 编译问题解决期间出现十几次报错，详细解决办法看这里 编译完成编译成功后，输出如下: 12345678910111213141516171819&gt;&gt;&gt;Finished making images @ Wed Jan 4 17:55:59 CST 2017 ...############################################################################# Leaving jdk for target(s) sanity all images ################################################################################## Build time 00:07:28 jdk for target(s) sanity all images ##############################################################################-- Build times ----------Target fastdebug_buildStart 2017-01-04 17:47:58End 2017-01-04 17:55:5900:00:13 corba00:00:09 hotspot00:00:03 jaxp00:00:04 jaxws00:07:28 jdk00:00:03 langtools00:08:01 TOTAL------------------------- 编译结果: build/macosx-x86_64 build/macosx-x86_64-fastdebug 运行编译好的jdk: 12345$ cd build/macosx-x86_64-fastdebug$ bin/java -versionopenjdk version &quot;1.7.0-internal-fastdebug&quot;OpenJDK Runtime Environment (build 1.7.0-internal-fastdebug-root_2016_08_03_21_45-b00)OpenJDK 64-Bit Server VM (build 24.95-b01-fastdebug, mixed mode)","tags":[{"name":"Mac","slug":"Mac","permalink":"http://damowei.com/tags/Mac/"},{"name":"OpenJDK","slug":"OpenJDK","permalink":"http://damowei.com/tags/OpenJDK/"},{"name":"JVM","slug":"JVM","permalink":"http://damowei.com/tags/JVM/"}]}]